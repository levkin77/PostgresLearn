<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-06-08T10:05:00.3868624"><title>Использование psql | Postgres Полезные русурсы</title><script type="application/json" id="virtual-toc-data">[{"id":"windows","level":0,"title":"Что делать если некорректно отображаются русские буквы в Windows","anchor":"#windows"},{"id":"-7tdrnj_21","level":0,"title":"У меня несколько серверов для работы","anchor":"#-7tdrnj_21"},{"id":"psql","level":0,"title":"Небольшой справочник по командам psql","anchor":"#psql"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="icon" type="image/png" sizes="32x32" href="writerside_32.png"><link rel="icon" type="image/png" sizes="64x64" href="writerside_64.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Использование psql | Postgres Полезные русурсы"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Postgres Полезные русурсы Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/howto-usepsqlcmd.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Использование psql | Postgres Полезные русурсы"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/howto-usepsqlcmd.html#webpage",
    "url": "writerside-documentation/howto-usepsqlcmd.html",
    "name": "Использование psql | Postgres Полезные русурсы",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Postgres Полезные русурсы Help"
}</script><!-- End Schema.org --></head><body data-id="howto-usepsqlcmd" data-main-title="Использование psql" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Default-topic.md|Postgres - полезные ресурсы, руководства подсказки, советы///How-to.md|Советы"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Postgres Полезные русурсы  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="howto-usepsqlcmd" id="howto-usepsqlcmd.md">Использование psql</h1><p id="-7tdrnj_2">Сколько написано разных cheetsheet для psql, лучше обратится к официальной документации<br><a href="https://www.postgresql.org/docs/current/app-psql.html" id="-7tdrnj_4" data-external="true" rel="noopener noreferrer">psql-en</a><br><a href="https://postgrespro.ru/docs/postgrespro/16/app-psql" id="-7tdrnj_6" data-external="true" rel="noopener noreferrer">psql-ru</a></p><p id="-7tdrnj_7">Запомнить все метакоманды не просто, воспользуйтесь метасправкой <span class="control" id="-7tdrnj_8">\?</span></p><aside class="prompt" data-type="tip" data-title="" id="-7tdrnj_9"><p id="-7tdrnj_10">Очень полезно просто выучить почти все команды для работы с psql! <br> Почему?</p><ul class="list _bullet" id="-7tdrnj_12"><li class="list__item" id="-7tdrnj_13"><p>на многих серверах просто не будет графической оболочки</p></li><li class="list__item" id="-7tdrnj_14"><p>есть много команд упрощающих вашу работу</p></li><li class="list__item" id="-7tdrnj_15"><p>иногда возникают проблемы с различными IDE при выполнении запросов</p></li></ul></aside><section class="chapter"><h2 id="windows" data-toc="windows">Что делать если некорректно отображаются русские буквы в Windows</h2><p id="-7tdrnj_16">Предварительно установите нужную кодировку в cmd</p><div class="code-block" data-lang="bash">
chcp 1251
</div><p id="-7tdrnj_18">Альтернативным вариантом для устранения проблемы с кодировкой является переименование каталога <code class="code" id="-7tdrnj_19">C:\Program Files\PostgreSQL\16\share\locale\</code> в <code class="code" id="-7tdrnj_20">С:\Program Files\PostgreSQL\16\share\locale_bak\</code>.</p></section><section class="chapter"><h2 id="-7tdrnj_21" data-toc="-7tdrnj_21">У меня несколько серверов для работы</h2><p id="-7tdrnj_22">Используйте cmd файл нужного содержания, где укажите нужные вам параметры подключения к нужному серверу, например:</p><div class="code-block" data-lang="bash">
@echo off
chcp 1251
PATH D:\Program Files\PostgreSQL\16\bin;%PATH%
if not exist &quot;%APPDATA%\postgresql&quot; md &quot;%APPDATA%\postgresql&quot;
psql.exe -h localhost -U &quot;postgres&quot; -d postgres -p 5433 
pause
</div></section><section class="chapter"><h2 id="psql" data-toc="psql">Небольшой справочник по командам psql</h2><section class="chapter"><h3 id="-7tdrnj_24" data-toc="-7tdrnj_24">Подключаемся к базе</h3><div class="code-block" data-lang="bash">
psql -d devlearnpg -U postgres -W
</div><div class="code-block" data-lang="bash">
psql -h localhost -d devlearnpg -U postgres -W
</div></section><section class="chapter"><h3 id="-7tdrnj_27" data-toc="-7tdrnj_27">Меняем базу после подключения</h3><div class="code-block" data-lang="bash">
\c dbname 
</div><div class="code-block" data-lang="bash">
\c dbname username
</div></section><section class="chapter"><h3 id="-7tdrnj_30" data-toc="-7tdrnj_30">Я где - информация о подключении</h3><div class="code-block" data-lang="bash">
\conninfo
</div><p id="-7tdrnj_32">результат:</p><div class="code-block" data-lang="plaintext">
postgres=# \conninfo
Вы подключены к базе данных &quot;postgres&quot; как пользователь &quot;postgres&quot; (сервер &quot;localhost&quot;: адрес &quot;::1&quot;, порт &quot;5433&quot;).
postgres=#
</div></section><section class="chapter"><h3 id="-7tdrnj_34" data-toc="-7tdrnj_34">Смотрим текст запросов для специализированных команд</h3><p id="-7tdrnj_35">Когда выполняем дополнительные комманды в psql полезно иногда посмотреть сам sql выполняемый для той или иной комманды. <br> Используем параметр -E при подключении:</p><div class="code-block" data-lang="bash">
psql -h localhost -d devtestindex -U postgres -W -E
</div><p id="-7tdrnj_38">и выполняем например \dt<br> результат:</p><div class="code-block" data-lang="plaintext">
devtestindex=# \dt
********* ЗАПРОС *********
SELECT n.nspname as &quot;Schema&quot;,
  c.relname as &quot;Name&quot;,
  CASE c.relkind WHEN 'r' THEN 'table' WHEN 'v' THEN 'view' WHEN 'm' THEN 'materialized view' WHEN 'i' THEN 'index' WHEN 'S' THEN 'sequence' WHEN 't' THEN 'TOAST table' WHEN 'f' THEN 'foreign table' WHEN 'p' THEN 'partitioned table' WHEN 'I' THEN 'partitioned index' END as &quot;Type&quot;,
  pg_catalog.pg_get_userbyid(c.relowner) as &quot;Owner&quot;
FROM pg_catalog.pg_class c
     LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace
     LEFT JOIN pg_catalog.pg_am am ON am.oid = c.relam
WHERE c.relkind IN ('r','p','')
      AND n.nspname &lt;&gt; 'pg_catalog'
      AND n.nspname !~ '^pg_toast'
      AND n.nspname &lt;&gt; 'information_schema'
  AND pg_catalog.pg_table_is_visible(c.oid)
ORDER BY 1,2;
**************************

             Список отношений
 Схема  |     Имя     |   Тип   | Владелец
--------+-------------+---------+----------
 public | states      | таблица | postgres
 public | t_agg       | таблица | postgres
 public | testidx     | таблица | postgres
 public | testnoidx   | таблица | postgres
 public | teststat    | таблица | postgres
 public | testtbldata | таблица | postgres
(6 строк)
</div><p id="-7tdrnj_41">Далее смело используем запрос в любимой IDE!</p></section><section class="chapter"><h3 id="shell-psql" data-toc="shell-psql">Выполняем shell команды из подключенного psql</h3><p id="-7tdrnj_42">Метакоманда <span class="control" id="-7tdrnj_43">\!</span> позволяет переключиться в режим текущей оболочки, используемой как терминал.</p></section><section class="chapter"><h3 id="-7tdrnj_44" data-toc="-7tdrnj_44">Копирование данных в файл и из файла</h3><div class="code-block" data-lang="bash">
\copy (SELECT * FROM staging_assets WHERE pipe_length &lt; = 10.00) TO '~/Practice_Data/ten_footers.csv' WITH DELIMITER ',' CSV HEADER;
</div><div class="code-block" data-lang="bash">
\copy staging_assets FROM '~/Practice_Data/psql_pipe_tally.csv' WITH DELIMITER ',' CSV HEADER;
</div><p id="-7tdrnj_47">Используя метакоманду \o filename можно выводить в файл результаты выполняемых запросов</p></section><section class="chapter"><h3 id="-7tdrnj_48" data-toc="-7tdrnj_48">Мета \;</h3><p id="-7tdrnj_50">При использовании мета команды <span class="control" id="-7tdrnj_51">\;</span> запросы будут переданы одни раз:</p><div class="code-block" data-lang="sql">
-- три раза, т.е. три запроса
select 1; select 2; select 3;
</div><div class="code-block" data-lang="sql">
-- Один раз, т.е. один запрос
select 1\; select 2\; select 3;
</div></section><section class="chapter"><h3 id="i" data-toc="i">Мета \i</h3><p id="-7tdrnj_54">Выполнить файл</p><div class="code-block" data-lang="bash">
\i filename.sql 
</div></section></section><div class="last-modified">Last modified: 08 июня 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="how-to.html" class="navigation-links__prev">Советы</a><a href="psqlmeta-l.html" class="navigation-links__next">Мета l</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>