<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-05-15T09:21:07.3081132"><title>Денежные данные и операции | Postgres Полезные русурсы</title><script type="application/json" id="virtual-toc-data">[{"id":"money","level":0,"title":"Проверки работы типа money","anchor":"#money"},{"id":"numeric","level":0,"title":"Использование numeric","anchor":"#numeric"},{"id":"nix","level":0,"title":"Доступные локали в nix","anchor":"#nix"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="icon" type="image/png" sizes="32x32" href="writerside_32.png"><link rel="icon" type="image/png" sizes="64x64" href="writerside_64.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Денежные данные и операции | Postgres Полезные русурсы"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Postgres Полезные русурсы Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/db-design-monetary.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Денежные данные и операции | Postgres Полезные русурсы"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/db-design-monetary.html#webpage",
    "url": "writerside-documentation/db-design-monetary.html",
    "name": "Денежные данные и операции | Postgres Полезные русурсы",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Postgres Полезные русурсы Help"
}</script><!-- End Schema.org --></head><body data-id="db-design-monetary" data-main-title="Денежные данные и операции" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Default-topic.md|Postgres - полезные ресурсы, руководства подсказки, советы///db-design.md|Проектирование баз данных"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Postgres Полезные русурсы  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="db-design-monetary" id="db-design-monetary.md">Денежные данные и операции</h1><p id="qa6l5t_251">Для работы с &quot;денежными&quot; данными наилучшим типом будет использование <span class="control" id="qa6l5t_252">numeric</span>.</p><section class="chapter"><h2 id="money" data-toc="money">Проверки работы типа money</h2><div class="code-block" data-lang="sql">
select 10.55::money/1::int as resdiv1,
       10.55::money/2::int as resdiv2,
       (10.55::money/2::int) * 2::int as resdiv2sup2;

</div><p id="qa6l5t_254">в результате не очень хороший результат при при операции умножения/деления</p><div class="table-wrapper"><table class="wide" id="qa6l5t_255"><thead><tr class="ijRowHead" id="qa6l5t_256"><th id="qa6l5t_257"><p>resdiv1</p></th><th id="qa6l5t_258"><p>resdiv2</p></th><th id="qa6l5t_259"><p>resdiv2sup2</p></th></tr></thead><tbody><tr id="qa6l5t_260"><td id="qa6l5t_261"><p>10,55 ₽</p></td><td id="qa6l5t_262"><p>5,27 ₽</p></td><td id="qa6l5t_263"><p>10,54 ₽</p></td></tr></tbody></table></div><p id="qa6l5t_264">Проверка типов</p><div class="code-block" data-lang="sql">
select pg_typeof(1::money/1::int),   -- money
       pg_typeof(1::money/1::money), -- double precision
       pg_typeof(1::money/1::numeric(18,6)); -- money
</div><p id="qa6l5t_266">Результат</p><div class="table-wrapper"><table class="wide" id="qa6l5t_267"><thead><tr class="ijRowHead" id="qa6l5t_268"><th id="qa6l5t_269"><p>pg_typeof</p></th><th id="qa6l5t_270"><p>pg_typeof</p></th><th id="qa6l5t_271"><p>pg_typeof</p></th></tr></thead><tbody><tr id="qa6l5t_272"><td id="qa6l5t_273"><p>money</p></td><td id="qa6l5t_274"><p>double precision</p></td><td id="qa6l5t_275"><p>money</p></td></tr></tbody></table></div><p id="qa6l5t_276">Для проверки текущего параметра <span class="control" id="qa6l5t_277">lc_monetary</span></p><div class="code-block" data-lang="sql">
show lc_monetary;
</div><p id="qa6l5t_279">Для установки</p><div class="code-block" data-lang="sql">
--set lc_monetary  = 'en_US';
--set lc_monetary  = 'ru_RU';
set lc_monetary  = 'ru_RU.utf8';
--set lc_monetary  = 'de_DE';
</div><p id="qa6l5t_281">Для сброса</p><div class="code-block" data-lang="sql">
set lc_monetary to default;
</div></section><section class="chapter"><h2 id="numeric" data-toc="numeric">Использование numeric</h2><p id="qa6l5t_283">Проверка типов</p><div class="code-block" data-lang="sql">
select pg_typeof(1::numeric(15,6)/1::int),
       pg_typeof(1::numeric(15,6)/1::bigint),
       pg_typeof(1::numeric(15,6)/1::numeric(19,6)),
       pg_typeof(1::numeric(15,6)/1::numeric(19,6));
</div><p id="qa6l5t_285">результат</p><div class="table-wrapper"><table class="wide" id="qa6l5t_286"><thead><tr class="ijRowHead" id="qa6l5t_287"><th id="qa6l5t_288"><p>pg_typeof</p></th><th id="qa6l5t_289"><p>pg_typeof</p></th><th id="qa6l5t_290"><p>pg_typeof</p></th><th id="qa6l5t_291"><p>pg_typeof</p></th></tr></thead><tbody><tr id="qa6l5t_292"><td id="qa6l5t_293"><p>numeric</p></td><td id="qa6l5t_294"><p>numeric</p></td><td id="qa6l5t_295"><p>numeric</p></td><td id="qa6l5t_296"><p>numeric</p></td></tr></tbody></table></div><aside class="prompt" data-type="warning" data-title="" id="qa6l5t_297"><p id="qa6l5t_298">Операция<br><span class="control" id="qa6l5t_300">select pg_typeof(1::numeric(15,6)/1::money)</span><br> приводит к ошибке</p></aside><p id="qa6l5t_302">Проверки деления</p><div class="code-block" data-lang="sql">
select 10.55::numeric(15,6)/1::int as res_div_1,
       10.55::numeric(15,6)/2::int as res_div_2,
       (10.55::numeric(15,6)/2::int) * 2::int as res_div_2_sup_2;
</div><div class="table-wrapper"><table class="wide" id="qa6l5t_304"><thead><tr class="ijRowHead" id="qa6l5t_305"><th id="qa6l5t_306"><p>res_div_1</p></th><th id="qa6l5t_307"><p>res_div_2</p></th><th id="qa6l5t_308"><p>res_div_2_sup_2</p></th></tr></thead><tbody><tr id="qa6l5t_309"><td id="qa6l5t_310"><p>10.55</p></td><td id="qa6l5t_311"><p>5.275</p></td><td id="qa6l5t_312"><p>10.55</p></td></tr></tbody></table></div><div class="code-block" data-lang="sql">
select 10.55::numeric(15,6)/2::bigint as res_div_2,
       (10.55::numeric(15,6)/2::bigint) * 2::int as res_div_2_sup_2;

select 10.55::numeric(15,6)/2::numeric(15,6) as res_div_2,
       (10.55::numeric(15,6)/2::numeric(15,6)) * 2::int as res_div_2_sup_2;
</div><div class="table-wrapper"><table class="wide" id="qa6l5t_314"><thead><tr class="ijRowHead" id="qa6l5t_315"><th id="qa6l5t_316"><p>res_div_2</p></th><th id="qa6l5t_317"><p>res_div_2_sup_2</p></th></tr></thead><tbody><tr id="qa6l5t_318"><td id="qa6l5t_319"><p>5.275</p></td><td id="qa6l5t_320"><p>10.55</p></td></tr></tbody></table></div><p id="qa6l5t_321">Для проверки параметра <span class="control" id="qa6l5t_322">lc_numeric</span></p><div class="code-block" data-lang="sql">
show lc_numeric; 
</div><p id="qa6l5t_324">Для сброса</p><div class="code-block" data-lang="sql">
set lc_numeric to default;
</div><p id="qa6l5t_326">Для установки</p><div class="code-block" data-lang="sql">
set lc_monetary  = 'ru_RU.utf8';
--set lc_monetary  = 'Russian_Russia.1251';
</div><aside class="prompt" data-type="note" data-title="" id="qa6l5t_328"><p id="qa6l5t_329">Еще о денежных типах Если необходимо хранить данные в разных валютах, помимо данных о &quot;денежнем выражении&quot; в виде numeric, желательно хранить и &quot;валюту&quot;, например из справочника валют или в виде числового кода iso для валюты. Это значительно облегчит перевод и представление информации в отформатированном виде и способах которые могут применятся для округления.</p></aside></section><section class="chapter"><h2 id="nix" data-toc="nix">Доступные локали в nix</h2><div class="code-block" data-lang="bash">
locale -a
</div><p id="qa6l5t_331">результат</p><div class="code-block" data-lang="plaintext">
C.utf8
en_AG
en_AG.utf8
en_AU.utf8
en_BW.utf8
en_CA.utf8
en_DK.utf8
en_GB.utf8
en_HK.utf8
en_IE.utf8
en_IL
en_IL.utf8
en_IN
en_IN.utf8
en_NG
en_NG.utf8
en_NZ.utf8
en_PH.utf8
en_SG.utf8
en_US.utf8
en_ZA.utf8
en_ZM
en_ZM.utf8
en_ZW.utf8
POSIX
ru_RU.utf8
ru_UA.utf8
</div></section><div class="last-modified">Last modified: 15 мая 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="db-design-treesidparentkind.html" class="navigation-links__prev">Улучшение дерева</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>