<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-05-15T06:54:49.4059168"><title>Простая реализация EVA | Postgres Полезные русурсы</title><script type="application/json" id="virtual-toc-data">[{"id":"-eben6g_58","level":0,"title":"Таблицы","anchor":"#-eben6g_58"},{"id":"-eben6g_91","level":0,"title":"Скрипты создания таблиц и первоначальное заполнения данными","anchor":"#-eben6g_91"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="frontend/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="icon" type="image/png" sizes="32x32" href="writerside_32.png"><link rel="icon" type="image/png" sizes="64x64" href="writerside_64.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Простая реализация EVA | Postgres Полезные русурсы"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Postgres Полезные русурсы Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/db-design-simpleeav.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Простая реализация EVA | Postgres Полезные русурсы"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/db-design-simpleeav.html#webpage",
    "url": "writerside-documentation/db-design-simpleeav.html",
    "name": "Простая реализация EVA | Postgres Полезные русурсы",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Postgres Полезные русурсы Help"
}</script><!-- End Schema.org --></head><body data-id="db-design-simpleeav" data-main-title="Простая реализация EVA" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Default-topic.md|Postgres - полезные ресурсы, руководства подсказки, советы///db-design.md|Проектирование баз данных"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Postgres Полезные русурсы  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="db-design-simpleeav" id="db-design-simpleeav.md">Простая реализация EVA</h1><p id="-eben6g_54">Очень простая модель для представления. Принцип модели позволяет решит наиболее распостраненную задачу:</p><ul class="list _bullet" id="-eben6g_55"><li class="list__item" id="-eben6g_56"><p>имеется таблица товаров (или людой другой сущности), у которой должно быть какое-то количество атрибутов, которые на текущий момент еще не все известны. И вообще не известно их будущее количество.</p></li><li class="list__item" id="-eben6g_57"><p>нужно предоставить возможность хранить неограниченное количество дополнительных атрибутов</p></li></ul><section class="chapter"><h2 id="-eben6g_58" data-toc="-eben6g_58">Таблицы</h2><ol class="list _decimal" id="-eben6g_59" type="1"><li class="list__item" id="-eben6g_60"><p><span class="control" id="-eben6g_61">products</span> - товары</p></li><li class="list__item" id="-eben6g_62"><p><span class="control" id="-eben6g_63">productcodenames</span> - наименования дополнительных свойств (атрибутов)</p></li><li class="list__item" id="-eben6g_64"><p><span class="control" id="-eben6g_65">productcodes</span> - значения дополнительных свойств (атрибутов)</p></li></ol><figure id="-eben6g_66"><img alt="simple_eva.png" src="images/simple_eva.png" title="simple_eva.png" width="1151" height="512"></figure><p id="-eben6g_67">Обратите вниимание на столбец <span class="control" id="-eben6g_68">kind</span> таблицы <span class="control" id="-eben6g_69">productcodenames</span> - это значение фактически определяет в каком столбце таблицы <span class="control" id="-eben6g_70">productcodes</span> хранится значение.</p><ul class="list _bullet" id="-eben6g_71"><li class="list__item" id="-eben6g_72"><p>1 - соответвует полю vint таблицы <span class="control" id="-eben6g_73">productcodes</span></p></li><li class="list__item" id="-eben6g_74"><p>2 - соответвует полю vtext таблицы <span class="control" id="-eben6g_75">productcodes</span></p></li><li class="list__item" id="-eben6g_76"><p>3 - и т.д.</p></li></ul><p id="-eben6g_77">Так как сам столбец <span class="control" id="-eben6g_78">kind</span> таблицы <span class="control" id="-eben6g_79">productcodenames</span> можно трактовать как &quot;основное значение&quot;, то в остальных колонках таблицы можно хранить дополнительные значения.</p><p id="-eben6g_80">Путем расширения количества столбцов в таблице <span class="control" id="-eben6g_81">productcodes</span> и значений для столбца <span class="control" id="-eben6g_82">kind</span> таблицы <span class="control" id="-eben6g_83">productcodenames</span> можно охватить все возможные типы значений. <br> Не стоит значительно увлекаться наличием типизированных полей и увеличивать их под каждый тип следуя &quot;строгой типизации&quot;. Можно совмещать значения для типов меньшей размерности и хранить их в соответствующем поле, например: в поле <span class="control" id="-eben6g_85">vint</span> можно хранить bool и т.д.</p><p id="-eben6g_86">Реализация в данной схеме очень проста и эффективна, а со временем значения из соответствующих &quot;дополнительных атрибутов&quot; можно уже будет переносить непосредственно в основную таблицу <span class="control" id="-eben6g_87">products</span> или сделать соотвествующее представление для разворота необходимых свойств в &quot;поля&quot;.</p><p id="-eben6g_88">Примеры sql получения данных</p><div class="code-block" data-lang="sql">
select p.*, pv.code_id, pn.name as pname, pv.vint
from public.products p
     left join public.productcodes pv on p.id = pv.produc_id and pv.code_id=1
     inner join public.productcodenames pn on pv.code_id = pn.id
where p.id=1;
</div><div class="code-block" data-lang="sql">
with p_int as (select vint, produc_id from public.productcodes where code_id=1 and produc_id=1)
,p_str as (select vtext, produc_id from public.productcodes where code_id=2 and produc_id=1)
select p.*, p_int.vint, p_str.vtext  from public.products p
left join p_int on p_int.produc_id=p.id
left join p_str on p_str.produc_id=p.id
where p.id=1
</div></section><section class="chapter"><h2 id="-eben6g_91" data-toc="-eben6g_91">Скрипты создания таблиц и первоначальное заполнения данными</h2><p id="-eben6g_92"><a data-external="true" id="-eben6g_93" href="resources/postgres16_localhost-devschemaeav1.sql" target="_blank" rel="noopener noreferrer">Скрипт создания таблиц</a></p><p id="-eben6g_94">Таблица <span class="control" id="-eben6g_95">products</span></p><div class="code-block" data-lang="sql">
INSERT INTO public.products (id, name, memo) VALUES (1, 'product 1', null);
INSERT INTO public.products (id, name, memo) VALUES (2, 'product 2', null);
</div><p id="-eben6g_97">Таблица <span class="control" id="-eben6g_98">productcodenames</span></p><div class="code-collapse" data-lang="sql" data-is-expanded="false" data-synopsis="INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (1, 1, 'int value', null, 'val_int');">
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (1, 1, 'int value', null, 'val_int');
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (2, 2, 'text value', null, 'val_text');
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (3, 3, 'date value', null, 'val_date');
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (4, 4, 'num values', null, 'val_num');
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (5, 5, 'money values', null, 'val_money');
INSERT INTO public.productcodenames (id, kind, name, memo, code) VALUES (6, 6, 'json value', null, 'val_json');
</div><p id="-eben6g_100">Таблица <span class="control" id="-eben6g_101">productcodes</span></p><div class="code-collapse" data-lang="sql" data-is-expanded="false" data-synopsis="truncate table public.productcodes;">
truncate table public.productcodes;
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (1, 1, 1, 11, null, null, null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (2, 1, 2, null, 'value text', null, null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (3, 1, 3, null, null, '2024-04-29', null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (4, 1, 4, null, null, null, 10.025000, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (5, 1, 5, null, null, null, null, '25,00 ?', null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (6, 1, 6, null, null, null, null, null, '[&quot;test&quot;, &quot;ttest2&quot;]', null);

INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (7, 2, 1, 15, null, null, null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (8, 2, 2, null, 'valueText ', null, null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (9, 2, 3, null, null, '2024-04-30', null, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (10, 2, 4, null, null, null, 10.000256, null, null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (11, 2, 5, null, null, null, null, '27,99 ?', null, null);
INSERT INTO public.productcodes (id, produc_id, code_id, vint, vtext, vdate, vnum, vmoney, vjson, memo) VALUES (12, 2, 6, null, null, null, null, null, '[&quot;testval&quot;, &quot;testval2&quot;]', null);
</div></section><div class="last-modified">Last modified: 15 мая 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="database-desing-typesubtype.html" class="navigation-links__prev">Хранение данных о типе и подтипе объекта</a><a href="db-design-simpleeavfa.html" class="navigation-links__next">Простая реализация EVA с учетом факта времени</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="frontend/app.js"></script></body></html>